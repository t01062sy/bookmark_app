# 開発・テスト環境連携ガイド

BookmarkAppプロジェクトの効率的な開発・テスト環境の使い分けについて説明します。

## 環境構成

### 開発Mac（現在の環境）
- **用途**: コード開発、Simulator動作確認、バックエンド開発
- **制限**: iPhone実機接続不可（セキュリティポリシー）
- **環境**: `/Users/shohei.yoneda/playground/bookmark_app/`

### テスト用Mac（別Mac）
- **用途**: iPhone実機での最終動作確認、Share Extension実機テスト
- **要件**: iPhone接続可能、Apple ID (Personal Team)
- **環境**: Git cloneで同期

## ワークフロー

### 開発フェーズ（開発Mac）

#### 1. コード開発
```bash
# 通常の開発作業
cd /Users/shohei.yoneda/playground/bookmark_app/
# Swift/React/TypeScript コード編集
```

#### 2. iOS Simulator確認
```bash
# iOS Simulatorでの動作確認
cd ios/BookmarkApp
open BookmarkApp.xcodeproj
# Command + R でSimulator実行
```

#### 3. Web PWA確認  
```bash
# Web版での動作確認
cd bookmark_app && npm run dev
# http://localhost:5173 でPWA確認
```

#### 4. Supabase Backend確認
```bash
# ローカルSupabase環境での確認
cd bookmark_app && supabase start
# Edge Functions等の動作確認
```

### テストフェーズ（テスト用Mac）

#### 1. 最新コード同期
```bash
# テスト用MacでGit同期
git pull origin main
```

#### 2. 実機テスト実行
```bash
# iOSアプリ実機確認
cd ios/BookmarkApp
open BookmarkApp.xcodeproj
# iPhone実機でCommand + R実行
```

#### 3. Share Extension実機テスト
```bash
# Share Extension実機動作確認
# Safari → 共有ボタン → Add to Bookmarks
```

## Git運用戦略

### ブランチ戦略
```
main ← 本番リリース用
 ↑
dev ← 開発作業用（開発Mac）
 ↑
feature/xxx ← 機能開発用
```

### 開発Mac → テスト用Mac同期
```bash
# 開発Mac側
git add .
git commit -m "feat: 新機能追加"
git push origin main

# テスト用Mac側  
git pull origin main
```

### テスト結果フィードバック
```bash
# テスト用Mac側（バグ修正等が必要な場合）
git checkout -b hotfix/real-device-fix
# 修正作業
git commit -m "fix: 実機テストで発見されたバグ修正"
git push origin hotfix/real-device-fix

# 開発Mac側
git pull origin hotfix/real-device-fix
git checkout main
git merge hotfix/real-device-fix
```

## 効率的な連携方法

### 1. 定期的な同期タイミング
- **毎日の開発終了時**: main branchにpush
- **機能完成時**: テスト用Macで実機確認
- **リリース前**: 最終的な実機テスト実施

### 2. コミュニケーション
実機テストで問題発見時:
```
Issue例:
Title: 【実機テスト】Share ExtensionでYouTubeリンクが正常保存されない
Body: 
- 環境: iPhone 15 Pro (iOS 17.5)
- 再現手順: YouTube → 共有 → Add to Bookmarks
- 期待結果: SourceTypeがyoutubeとして保存
- 実際結果: otherとして保存される
- 関連ファイル: ShareViewController.swift:174
```

### 3. テスト項目管理
```markdown
## 実機テスト チェックリスト

### 基本機能
- [ ] アプリ起動・ブックマーク一覧表示
- [ ] 検索・フィルタ機能
- [ ] ブックマーク編集・削除

### Share Extension
- [ ] Safari共有動作
- [ ] YouTube共有動作  
- [ ] Twitter/X共有動作
- [ ] エラーハンドリング

### パフォーマンス
- [ ] 起動速度 (目標: 3秒以内)
- [ ] 検索応答速度 (目標: 1秒以内)
- [ ] スクロール滑らかさ
```

## トラブルシューティング連携

### よくある実機テスト問題と対処

#### 1. Bundle Identifier競合
**問題**: テスト用Macで既存IDと競合
```bash
# 開発Mac側で対処
# project.pbxproj のBundle Identifier確認
grep -n "PRODUCT_BUNDLE_IDENTIFIER" BookmarkApp.xcodeproj/project.pbxproj
```

**解決**: テスト用Mac独自のIDに変更
```
com.devmac.BookmarkApp → com.testmac.BookmarkApp
```

#### 2. Personal Team期限切れ
**問題**: 7日後署名期限切れ
**解決**: 定期的な再ビルドの仕組み
```bash
# テスト用Mac用の定期実行スクリプト
#!/bin/bash
# weekly-rebuild.sh
cd /path/to/bookmark_app/ios/BookmarkApp
xcodebuild clean -project BookmarkApp.xcodeproj
xcodebuild build -project BookmarkApp.xcodeproj -scheme BookmarkApp
```

#### 3. 環境差異問題
**開発Mac環境**:
- iOS Simulator: iOS 18.5
- Xcode: 15.4
- Swift: 5.0

**テスト用Mac環境**:
- iPhone実機: iOS 17.5
- Xcode: (バージョン確認必要)

**対処**: バージョン差異の文書化と対応

## セキュリティ・プライバシー考慮

### 開発Mac制限事項
- iPhone接続不可 → 実機特有問題の早期発見困難
- Personal Team制限 → 高度機能テスト不可

### テスト用Mac運用
- Personal Team使用 → 7日署名期限
- 個人デバイスのみ → 配布テスト不可
- Supabase本番環境 → テストデータ混入注意

### データ管理
```bash
# テスト専用Supabase環境設定（推奨）
# supabase/config.toml
[api]
enabled = true
port = 54321
schemas = ["public", "graphql_public"]
extra_search_path = ["public", "extensions"]
max_rows = 1000

[auth]
enabled = true
port = 54324
```

## 次のステップ

### 短期的改善
1. **自動化**: テスト用Mac環境の自動セットアップスクリプト
2. **CI/CD**: GitHub Actionsでの自動ビルドテスト
3. **ドキュメント**: 実機テスト結果の構造化記録

### 長期的改善
1. **Apple Developer Program**: 正式登録での制限解除
2. **TestFlight**: ベータテスト配布環境
3. **App Store**: 正式リリース環境

これで開発・テスト環境の効率的な連携が可能になります。